<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QS World University Rankings - Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        h1 { margin: 20px; }
        .chart { width: 80%; height: 500px; margin: 20px auto; }
    </style>
</head>
<body>
    <h1>QS World University Rankings - Interactive Visualizations</h1>

    <!-- 容器 -->
    <div id="bar-chart" class="chart"></div>
    <div id="map-chart" class="chart"></div>
    <div id="scatter-chart" class="chart"></div>
    <div id="radar-chart" class="chart"></div>
    <div id="line-chart" class="chart"></div>

    <script>
        fetch('data.csv')
            .then(response => response.text())
            .then(csvText => {
                const rows = csvText.split('\n').slice(1); // 跳过标题行

                // 数据存储
                const top100Data = [];
                const locationCount = {};
                const scatterData = [];
                const radarMetrics = ["SUS SCORE", "GER SCORE", "ar score"];
                const radarData = {};
                const lineData = {};

                rows.forEach(row => {
                    const cols = row.split(',');
                    const rank = parseInt(cols[1]);
                    const institution = cols[3];
                    const location = cols[5];
                    const score = parseFloat(cols[28]); // Overall Score
                    const susScore = parseFloat(cols[26]);
                    const gerScore = parseFloat(cols[24]);
                    const arScore = parseFloat(cols[10]);

                    // 1. 前 100 数据
                    if (rank && rank <= 100) {
                        top100Data.push({ name: institution, score });
                        radarData[institution] = [susScore, gerScore, arScore];
                        lineData[institution] = [rank, rank + 5, rank + 3]; // 模拟趋势数据
                    }

                    // 2. 国家分布统计
                    if (location) {
                        locationCount[location] = (locationCount[location] || 0) + 1;
                    }

                    // 3. 散点图数据
                    if (rank && score) {
                        scatterData.push([rank, score]);
                    }
                });

                // 渲染图表
                renderBarChart(top100Data);
                renderMapChart(locationCount);
                renderScatterChart(scatterData);
                renderRadarChart(radarData, radarMetrics);
                renderLineChart(lineData);
            });

        // 柱状图
        function renderBarChart(data) {
            const chart = echarts.init(document.getElementById('bar-chart'));
            const option = {
                title: { text: 'Top 100 Universities - Overall Score' },
                xAxis: { type: 'category', data: data.map(d => d.name), axisLabel: { rotate: 45 } },
                yAxis: { type: 'value' },
                series: [{ type: 'bar', data: data.map(d => d.score) }]
            };
            chart.setOption(option);
        }

        // 世界地图
        function renderMapChart(data) {
            const chart = echarts.init(document.getElementById('map-chart'));
            const mapData = Object.entries(data).map(([name, value]) => ({ name, value }));
            const option = {
                title: { text: 'University Distribution by Country' },
                visualMap: { min: 0, max: Math.max(...mapData.map(d => d.value)), inRange: { color: ['#e0ffff', '#006edd'] }},
                series: [{ name: 'University Count', type: 'map', map: 'world', roam: true, data: mapData }]
            };
            chart.setOption(option);
        }

        // 散点图
        function renderScatterChart(data) {
            const chart = echarts.init(document.getElementById('scatter-chart'));
            const option = {
                title: { text: 'Rank vs Overall Score' },
                xAxis: { name: 'Rank', type: 'value' },
                yAxis: { name: 'Overall Score', type: 'value' },
                series: [{ type: 'scatter', data: data }]
            };
            chart.setOption(option);
        }

        // 雷达图
        function renderRadarChart(data, metrics) {
            const chart = echarts.init(document.getElementById('radar-chart'));
            const indicator = metrics.map(metric => ({ name: metric, max: 100 }));
            const seriesData = Object.entries(data).map(([name, values]) => ({ name, value: values }));

            const option = {
                title: { text: 'University Performance Metrics' },
                radar: { indicator: indicator },
                series: [{ type: 'radar', data: seriesData }]
            };
            chart.setOption(option);
        }

        // 折线图
        function renderLineChart(data) {
            const chart = echarts.init(document.getElementById('line-chart'));
            const option = {
                title: { text: 'Top Universities Ranking Trend' },
                xAxis: { type: 'category', data: ['2023', '2024', '2025'] },
                yAxis: { type: 'value', inverse: true },
                series: Object.entries(data).map(([name, values]) => ({ name, type: 'line', data: values }))
            };
            chart.setOption(option);
        }
    </script>
</body>
</html>
