<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QS World University Rankings Visualization</title>
    <!-- 引入 ECharts 和世界地图组件 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; }
        h1 { margin: 20px; }
        .chart-container { width: 45%; height: 500px; display: inline-block; margin: 10px; }
    </style>
</head>
<body>
    <h1>QS World University Rankings 2025</h1>
    <!-- 容器 -->
    <div id="bar-chart" class="chart-container"></div>
    <div id="map-chart" class="chart-container"></div>
    <div id="scatter-chart" class="chart-container"></div>
    <div id="radar-chart" class="chart-container"></div>
    <div id="pie-chart" class="chart-container"></div>

    <script>
        fetch('data.csv')
            .then(response => response.text())
            .then(csvText => {
                const rows = csvText.split('\n').slice(1); // 跳过标题行

                // 数据存储
                const top10Data = [];
                const locationCount = {};
                const scatterData = [];
                const radarMetrics = ['ar score', 'ger score', 'SUS SCORE'];
                const radarData = {};

                // 解析 CSV 数据
                rows.forEach(row => {
                    const cols = row.split(',');
                    const rank = parseInt(cols[0]);
                    const institution = cols[1];
                    const location = cols[3];
                    const score = parseFloat(cols[26]);

                    if (rank && rank <= 10) {
                        top10Data.push({ name: institution, value: score });
                        radarData[institution] = [parseFloat(cols[8]), parseFloat(cols[24]), parseFloat(cols[25])];
                    }

                    if (location) {
                        locationCount[location] = (locationCount[location] || 0) + 1;
                    }

                    if (rank && score) scatterData.push([rank, score]);
                });

                // 渲染图表
                renderBarChart(top10Data);
                renderMapChart(locationCount);
                renderScatterChart(scatterData);
                renderRadarChart(radarData, radarMetrics);
                renderPieChart(locationCount);
            });

        // 柱状图
        function renderBarChart(data) {
            const chart = echarts.init(document.getElementById('bar-chart'));
            chart.setOption({
                title: { text: 'Top 10 Universities - Overall Score' },
                xAxis: { type: 'category', data: data.map(d => d.name), axisLabel: { rotate: 45 } },
                yAxis: { type: 'value', name: 'Overall Score' },
                series: [{ type: 'bar', data: data.map(d => d.value), itemStyle: { color: '#73b9bc' } }]
            });
        }

        // 世界地图
        function renderMapChart(data) {
            const chart = echarts.init(document.getElementById('map-chart'));
            const mapData = Object.entries(data).map(([name, value]) => ({ name, value }));
            chart.setOption({
                title: { text: 'University Distribution by Country' },
                visualMap: { min: 0, max: Math.max(...mapData.map(d => d.value)), inRange: { color: ['#e0ffff', '#006edd'] } },
                series: [{ type: 'map', map: 'world', roam: true, data: mapData }]
            });
        }

        // 散点图
        function renderScatterChart(data) {
            const chart = echarts.init(document.getElementById('scatter-chart'));
            chart.setOption({
                title: { text: 'Rank vs Overall Score' },
                xAxis: { name: 'Rank', type: 'value' },
                yAxis: { name: 'Overall Score', type: 'value' },
                series: [{ type: 'scatter', data }]
            });
        }

        // 雷达图
        function renderRadarChart(data, metrics) {
            const chart = echarts.init(document.getElementById('radar-chart'));
            const indicator = metrics.map(metric => ({ name: metric, max: 100 }));
            const seriesData = Object.entries(data).map(([name, values]) => ({ name, value: values }));
            chart.setOption({
                title: { text: 'Top 5 Universities - Key Metrics' },
                radar: { indicator },
                series: [{ type: 'radar', data: seriesData }]
            });
        }

        // 饼图
        function renderPieChart(data) {
            const chart = echarts.init(document.getElementById('pie-chart'));
            const pieData = Object.entries(data).map(([name, value]) => ({ name, value }));
            chart.setOption({
                title: { text: 'University Distribution by Region' },
                series: [{ type: 'pie', radius: '50%', data: pieData }]
            });
        }
    </script>
</body>
</html>
