<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QS World University Rankings Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        h1, h2 { margin: 20px; }
        #bar-chart, #pie-chart { width: 80%; height: 500px; margin: 0 auto; }
    </style>
</head>
<body>
    <h1>QS World University Rankings 2025</h1>

    <!-- 容器：柱状图 -->
    <h2>Top 10 Universities - Overall Score</h2>
    <div id="bar-chart"></div>

    <!-- 容器：饼状图 -->
    <h2>University Distribution by Location</h2>
    <div id="pie-chart"></div>

    <script>
        async function loadData() {
            // 1. 加载 CSV 数据
            const response = await fetch('data.csv');
            const text = await response.text();
            const rows = text.split('\n').slice(1);

            // 2. 提取 Top 10 大学数据 & 地区分布
            const top10Data = [];
            const locationCounts = {};

            rows.forEach(row => {
                const cols = row.split(',');
                const institution = cols[2]; // 大学名称
                const location = cols[4];    // 国家/地区
                const score = parseFloat(cols[28]); // Overall Score
                
                if (institution && score) {
                    top10Data.push({ name: institution, score });
                }

                // 统计地区分布
                if (location) {
                    locationCounts[location] = (locationCounts[location] || 0) + 1;
                }
            });

            // 3. 处理前 10 数据
            const sortedTop10 = top10Data.sort((a, b) => b.score - a.score).slice(0, 10);

            // 4. 转换地区数据
            const pieData = Object.keys(locationCounts).map(key => ({
                name: key,
                value: locationCounts[key]
            }));

            // 渲染图表
            renderBarChart(sortedTop10);
            renderPieChart(pieData);
        }

        function renderBarChart(data) {
            const chart = echarts.init(document.getElementById('bar-chart'));
            const option = {
                title: { text: 'Top 10 Universities - Overall Score' },
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: data.map(d => d.name),
                    axisLabel: { rotate: 45 }
                },
                yAxis: { type: 'value', name: 'Overall Score' },
                series: [{
                    data: data.map(d => d.score),
                    type: 'bar',
                    itemStyle: { color: '#5470c6' }
                }]
            };
            chart.setOption(option);
        }

        function renderPieChart(data) {
            const chart = echarts.init(document.getElementById('pie-chart'));
            const option = {
                title: { text: 'University Distribution by Location' },
                tooltip: { trigger: 'item' },
                series: [{
                    name: 'Universities',
                    type: 'pie',
                    radius: '50%',
                    data: data,
                    label: { formatter: '{b}: {c}' }
                }]
            };
            chart.setOption(option);
        }

        // 执行数据加载和渲染
        loadData();
    </script>
</body>
</html>
