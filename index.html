<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f8;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            font-size: 28px;
        }
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: auto;
            gap: 20px;
            max-width: 1400px;
            margin: 20px auto;
        }
        .chart {
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
        }
        #heatmapChart, #scatterChart, #radarChart {
            grid-column: span 2;
        }
    </style>
</head>
<body>
    <h1>全球大学排名可视化仪表盘</h1>
    <div class="dashboard-container">
        <div id="barChart" class="chart" style="height: 400px;"></div>
        <div id="pieChart" class="chart" style="height: 400px;"></div>
        <div id="lineChart" class="chart" style="height: 400px;"></div>
        <div id="dualBarChart" class="chart" style="height: 400px;"></div>
        <div id="scatterChart" class="chart" style="height: 400px;"></div>
        <div id="radarChart" class="chart" style="height: 400px;"></div>
    </div>

    <script>
        async function loadData() {
            const response = await fetch('data.csv');
            const csvText = await response.text();
            const rows = csvText.split('\n').map(row => row.split(','));
            const headers = rows[0];
            const data = rows.slice(1).filter(row => row.length >= 5 && row[1] && !isNaN(parseFloat(row[4])));
            
            const institutions = data.map(row => row[1]);
            const scores = data.map(row => parseFloat(row[4]));
            const locations = data.map(row => row[3]);
            const countries = data.map(row => row[2]);
            const rankings = data.map(row => row[0]);

            renderCharts(institutions, scores, locations, countries, rankings);
        }

        function renderCharts(institutions, scores, locations, countries, rankings) {
            const barChart = echarts.init(document.getElementById('barChart'));
            const barOption = {
                title: { text: '高校综合评分柱状图' },
                xAxis: { type: 'category', data: institutions.slice(0, 20), axisLabel: { interval: 1, rotate: 30 } },
                yAxis: { type: 'value' },
                series: [{ type: 'bar', data: scores.slice(0, 20), barWidth: '50%', itemStyle: { color: '#4B8BF4' } }]
            };
            barChart.setOption(barOption);

            const pieChart = echarts.init(document.getElementById('pieChart'));
            const locationCounts = {};
            locations.forEach(loc => locationCounts[loc] = (locationCounts[loc] || 0) + 1);
            const pieData = Object.keys(locationCounts).map(loc => ({ name: loc, value: locationCounts[loc] }));
            const pieOption = { title: { text: '高校分布饼图 (地区)' }, series: [{ type: 'pie', data: pieData }] };
            pieChart.setOption(pieOption);

            const lineChart = echarts.init(document.getElementById('lineChart'));
            const lineOption = {
                title: { text: '高校排名与评分折线图' },
                xAxis: { type: 'category', data: rankings.map(r => '排名 ' + r) },
                yAxis: { type: 'value' },
                series: [{ data: scores, type: 'line', smooth: true, itemStyle: { color: '#E9897E' } }]
            };
            lineChart.setOption(lineOption);

            const dualBarChart = echarts.init(document.getElementById('dualBarChart'));
            const countryCounts = {};
            countries.forEach(country => countryCounts[country] = (countryCounts[country] || 0) + 1);
            const countryScores = Object.keys(countryCounts).map(country => {
                const scoresForCountry = scores.filter((_, i) => countries[i] === country);
                return scoresForCountry.reduce((a, b) => a + b, 0) / scoresForCountry.length;
            });
            const dualBarOption = {
                title: { text: '国家大学数量与平均评分' },
                xAxis: { type: 'category', data: Object.keys(countryCounts) },
                yAxis: { type: 'value' },
                series: [
                    { name: '大学数量', type: 'bar', data: Object.values(countryCounts) },
                    { name: '平均评分', type: 'bar', data: countryScores }
                ]
            };
            dualBarChart.setOption(dualBarOption);

            const scatterChart = echarts.init(document.getElementById('scatterChart'));
            const scatterData = rankings.map((rank, i) => [parseInt(rank), scores[i]]);
            const scatterOption = {
                title: { text: '排名与评分散点图' },
                xAxis: { type: 'value', name: '排名' },
                yAxis: { type: 'value', name: '评分' },
                series: [{ type: 'scatter', data: scatterData, itemStyle: { color: '#73C0DE' } }]
            };
            scatterChart.setOption(scatterOption);

            const radarChart = echarts.init(document.getElementById('radarChart'));
            const radarOption = {
                title: { text: '高校评分雷达图' },
                radar: { indicator: institutions.slice(0, 6).map(name => ({ name, max: 100 })) },
                series: [{ type: 'radar', data: [{ value: scores.slice(0, 6), name: '评分' }] }] 
            };
            radarChart.setOption(radarOption);
        }

        loadData();
    </script>
</body>
</html>
